<template>
  <v-card
    outlined
    elevation="2"
  >
    <v-row>
      <v-col
        cols="12"
        lg="6"
      >
        <PaymentWrapper
          v-if="state.payment.applicationCost"
          :payment="state.payment"
        />
      </v-col>
      <v-col
        cols="12"
        lg="4"
      >
        <PaymentButtonContainer
          :cash-payment="handleCashPayment"
          @on-submit-online-payment="onSubmitOnlinePayment"
        />
      </v-col>
    </v-row>
  </v-card>
</template>

<script setup lang="ts">
import PaymentButtonContainer from '@core-public/components/containers/PaymentButtonContainer.vue'
import PaymentWrapper from '@core-public/components/wrappers/PaymentWrapper.vue'
import { useBrandStore } from '@shared-ui/stores/brandStore'
import { useCompleteApplicationStore } from '@shared-ui/stores/completeApplication'
import { usePaymentStore } from '@core-public/stores/paymentStore'
import { onMounted, reactive } from 'vue'

interface IProps {
  togglePayment: CallableFunction
}

const emit = defineEmits(['on-submit-online-payment'])
const brandStore = useBrandStore()
const application = useCompleteApplicationStore()
const paymentStore = usePaymentStore()

const props = defineProps<IProps>()

const state = reactive({
  payment: {
    applicationCost: 0,
    convenienceFee: 0,
    creditFee: 0,
    totalCost: 0,
  },
  isLoading: false,
  isError: false,
})

onMounted(() => {
  switch (application.completeApplication.application.applicationType) {
    case 'standard':
      state.payment.applicationCost = brandStore.brand.cost.new.standard
      break
    case 'judicial':
      state.payment.applicationCost = brandStore.brand.cost.new.judicial
      break
    case 'reserve':
      state.payment.applicationCost = brandStore.brand.cost.new.reserve
      break
    case 'modify-standard':
      state.payment.applicationCost = brandStore.brand.cost.modify
      break
    case 'modify-judicial':
      state.payment.applicationCost = brandStore.brand.cost.modify
      break
    case 'modify-reserve':
      state.payment.applicationCost = brandStore.brand.cost.modify
      break
    case 'renew-standard':
      state.payment.applicationCost = brandStore.brand.cost.renew.standard
      break
    case 'renew-judicial':
      state.payment.applicationCost = brandStore.brand.cost.renew.judicial
      break
    case 'renew-reserve':
      state.payment.applicationCost = brandStore.brand.cost.renew.reserve
      break
    case 'duplicate-standard':
      state.payment.applicationCost = brandStore.brand.cost.modify
      break
    case 'duplicate-judicial':
      state.payment.applicationCost = brandStore.brand.cost.modify
      break
    case 'duplicate-reserve':
      state.payment.applicationCost = brandStore.brand.cost.modify
      break
    default:
      return
  }

  state.payment.convenienceFee = brandStore.brand.cost.convenienceFee

  if (application.completeApplication.application.paymentStatus === 0) {
    state.payment.creditFee = brandStore.brand.cost.creditFee
  }

  state.payment.totalCost =
    state.payment.applicationCost +
    state.payment.convenienceFee +
    state.payment.creditFee
})

function handleCashPayment() {
  state.payment.creditFee = 0
  state.payment.totalCost =
    state.payment.applicationCost + state.payment.convenienceFee
  paymentStore.setPaymentType('cash')
  application.completeApplication.application.paymentStatus = 1
  props.togglePayment()
}

function onSubmitOnlinePayment() {
  paymentStore.setPaymentType('credit')
  application.completeApplication.application.paymentStatus = 2
  emit('on-submit-online-payment')
}
</script>
